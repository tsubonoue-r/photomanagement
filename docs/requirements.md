# 要件定義書

## 工事写真管理システム (PhotoManagement)

| 項目 | 内容 |
|------|------|
| ドキュメントID | REQ-001 |
| バージョン | 1.0.0 |
| 作成日 | 2025-12-28 |
| ステータス | Draft |

---

## 1. 概要

### 1.1 システム目的

本システムは、建設・土木工事現場における写真管理業務を効率化するWebアプリケーションです。
蔵衛門のような工事写真管理ソフトウェアの機能をWebベースで提供し、電子納品に対応した写真整理・管理機能を実現します。

### 1.2 背景・課題

- 工事現場での写真撮影枚数の増加（1現場あたり数千〜数万枚）
- 国土交通省の電子納品要領への準拠が必須
- 複数の作業員・監督者による同時作業の必要性
- 現場（モバイル）とオフィス（PC）の両方からのアクセス要件

### 1.3 対象ユーザー

| ユーザー種別 | 役割 | 主な利用シーン |
|------------|------|--------------|
| 現場監督 | 写真撮影・分類・管理 | 現場でのモバイル撮影、オフィスでの整理 |
| 工事管理者 | 写真承認・検索・出力 | 電子納品データ作成、検査対応 |
| システム管理者 | ユーザー管理・設定 | マスタ管理、権限設定 |

---

## 2. 機能要件

### 2.1 写真管理機能

#### FR-001: 写真登録

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-001-01 | 単一写真のアップロード（JPEG, PNG, HEIC対応） | Must |
| FR-001-02 | 複数写真の一括アップロード（ドラッグ＆ドロップ） | Must |
| FR-001-03 | モバイルカメラからの直接撮影・登録 | Must |
| FR-001-04 | EXIF情報の自動読み取り（撮影日時、GPS等） | Must |
| FR-001-05 | 写真の自動リサイズ・圧縮オプション | Should |

#### FR-002: 写真分類

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-002-01 | 工種による分類 | Must |
| FR-002-02 | 種別による分類 | Must |
| FR-002-03 | 細別による分類 | Must |
| FR-002-04 | 撮影箇所による分類 | Must |
| FR-002-05 | 測点（キロポスト）による分類 | Should |
| FR-002-06 | タグ（自由キーワード）による分類 | Should |

#### FR-003: 写真検索・閲覧

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-003-01 | 工種・種別・細別による絞り込み | Must |
| FR-003-02 | 撮影日による絞り込み | Must |
| FR-003-03 | フリーワード検索（写真タイトル、コメント） | Must |
| FR-003-04 | サムネイル一覧表示 | Must |
| FR-003-05 | 写真の詳細表示（拡大表示） | Must |
| FR-003-06 | 撮影位置のマップ表示 | Could |

#### FR-004: 写真編集

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-004-01 | 写真情報（タイトル、コメント）の編集 | Must |
| FR-004-02 | 分類情報の変更 | Must |
| FR-004-03 | 複数写真の一括分類変更 | Should |
| FR-004-04 | 写真の回転 | Should |
| FR-004-05 | 写真の削除（論理削除） | Must |

### 2.2 電子小黒板機能

#### FR-010: 小黒板作成

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-010-01 | 小黒板テンプレートの選択 | Must |
| FR-010-02 | 工事名、工種、撮影箇所等の入力 | Must |
| FR-010-03 | 撮影日の自動/手動設定 | Must |
| FR-010-04 | 備考欄（自由記述） | Must |
| FR-010-05 | 小黒板レイアウトのカスタマイズ | Should |

#### FR-011: 小黒板合成

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-011-01 | 撮影写真への小黒板合成（電子小黒板） | Must |
| FR-011-02 | 合成位置の調整（4隅選択） | Should |
| FR-011-03 | 合成サイズの調整 | Should |
| FR-011-04 | 合成前写真の保持（原本保存） | Must |

### 2.3 工事・案件管理機能

#### FR-020: 工事登録

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-020-01 | 工事情報の登録（工事名、発注者、請負者等） | Must |
| FR-020-02 | 工事期間の設定 | Must |
| FR-020-03 | 工事に紐づくユーザーの設定 | Must |
| FR-020-04 | 工種・種別・細別マスタの設定 | Must |

#### FR-021: 工種マスタ管理

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-021-01 | 国交省標準の工種・種別インポート | Must |
| FR-021-02 | 工種・種別・細別のカスタム追加 | Must |
| FR-021-03 | 工種マスタのエクスポート | Should |

### 2.4 電子納品機能

#### FR-030: 電子納品出力

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-030-01 | 国交省電子納品要領に準拠したフォルダ構成出力 | Must |
| FR-030-02 | PHOTO.XMLの自動生成 | Must |
| FR-030-03 | 写真ファイル名の自動リネーム（要領準拠） | Must |
| FR-030-04 | 納品メディアサイズに応じた分割出力 | Should |
| FR-030-05 | 納品データのプレビュー・検証 | Should |

#### FR-031: 帳票出力

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-031-01 | 工事写真台帳（PDF）の出力 | Must |
| FR-031-02 | 撮影位置図の出力 | Could |
| FR-031-03 | 写真一覧表（Excel）の出力 | Should |

### 2.5 ユーザー管理機能

#### FR-040: 認証

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-040-01 | メールアドレス/パスワードによるログイン | Must |
| FR-040-02 | パスワードリセット機能 | Must |
| FR-040-03 | ソーシャルログイン（Google） | Could |
| FR-040-04 | 二要素認証 | Could |

#### FR-041: ユーザー・権限管理

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-041-01 | ユーザーの登録・編集・削除 | Must |
| FR-041-02 | ロールベースのアクセス制御（RBAC） | Must |
| FR-041-03 | 工事単位でのユーザー権限設定 | Must |
| FR-041-04 | 招待機能（メール招待） | Should |

---

## 3. 非機能要件

### 3.1 性能要件

| ID | 要件 | 目標値 |
|----|------|--------|
| NFR-001 | ページ表示時間 | 3秒以内（初回）、1秒以内（キャッシュ時） |
| NFR-002 | 写真アップロード速度 | 10MB/分以上（通常回線） |
| NFR-003 | 検索レスポンス | 2秒以内（10万件） |
| NFR-004 | 同時接続ユーザー数 | 100ユーザー以上 |
| NFR-005 | 写真保存容量 | 工事あたり100GB以上 |

### 3.2 可用性要件

| ID | 要件 | 目標値 |
|----|------|--------|
| NFR-010 | システム稼働率 | 99.5%以上 |
| NFR-011 | 計画停止時間 | 月4時間以内 |
| NFR-012 | 障害復旧時間（RTO） | 4時間以内 |
| NFR-013 | データ復旧ポイント（RPO） | 1時間以内 |

### 3.3 セキュリティ要件

| ID | 要件 | 詳細 |
|----|------|------|
| NFR-020 | 通信暗号化 | HTTPS（TLS 1.3）必須 |
| NFR-021 | データ暗号化 | 保存データの暗号化（AES-256） |
| NFR-022 | 認証 | JWT認証、セッション管理 |
| NFR-023 | 監査ログ | ログイン、データ変更の記録 |
| NFR-024 | 脆弱性対策 | OWASP Top 10対応 |

### 3.4 拡張性要件

| ID | 要件 | 詳細 |
|----|------|------|
| NFR-030 | スケーラビリティ | 水平スケーリング対応 |
| NFR-031 | API | RESTful API提供 |
| NFR-032 | マルチテナント | テナント分離対応 |

### 3.5 運用性要件

| ID | 要件 | 詳細 |
|----|------|------|
| NFR-040 | バックアップ | 日次自動バックアップ |
| NFR-041 | モニタリング | システム稼働監視、アラート通知 |
| NFR-042 | ログ管理 | 90日間のログ保持 |

### 3.6 互換性要件

| ID | 要件 | 対象 |
|----|------|------|
| NFR-050 | ブラウザ | Chrome, Safari, Edge（最新2バージョン） |
| NFR-051 | モバイル | iOS 15以上, Android 12以上 |
| NFR-052 | 画面サイズ | レスポンシブデザイン（320px〜） |

---

## 4. 制約条件

### 4.1 技術制約

- フロントエンド: Next.js + TypeScript
- バックエンド: Next.js API Routes
- データベース: PostgreSQL (Supabase)
- ストレージ: AWS S3 または Cloudflare R2
- 認証: NextAuth.js

### 4.2 外部連携

- 国土交通省 電子納品要領（土木工事編）準拠
- デジタル工事写真の小黒板情報電子化対応

### 4.3 法令・規格

- 個人情報保護法への準拠
- 公共工事の電子納品要領（国土交通省）

---

## 5. 用語定義

| 用語 | 定義 |
|------|------|
| 工種 | 工事の大分類（例：土工、舗装工） |
| 種別 | 工種の中分類（例：切土、盛土） |
| 細別 | 種別の小分類（例：掘削、床掘） |
| 電子小黒板 | 写真に合成するデジタル黒板情報 |
| 電子納品 | 工事完了時に発注者へ提出する電子データ |
| PHOTO.XML | 電子納品の写真管理ファイル |

---

## 6. 参考資料

- 国土交通省「電子納品要領」
- 国土交通省「デジタル写真管理情報基準」
- 国土交通省「工事完成図書の電子納品等要領」

---

## 変更履歴

| バージョン | 日付 | 変更内容 | 担当 |
|-----------|------|----------|------|
| 1.0.0 | 2025-12-28 | 初版作成 | System |
